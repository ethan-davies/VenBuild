// Vencord b49dad6
// Standalone: true
// Platform: Universal
// Updater disabled: false
"use strict";var rr=Object.create;var Ee=Object.defineProperty;var ir=Object.getOwnPropertyDescriptor;var ar=Object.getOwnPropertyNames;var or=Object.getPrototypeOf,sr=Object.prototype.hasOwnProperty;var m=(e,t)=>()=>(e&&(t=e(e=0)),t);var Re=(e,t)=>{for(var n in t)Ee(e,n,{get:t[n],enumerable:!0})},xt=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ar(t))!sr.call(e,r)&&r!==n&&Ee(e,r,{get:()=>t[r],enumerable:!(i=ir(t,r))||i.enumerable});return e};var K=(e,t,n)=>(n=e!=null?rr(or(e)):{},xt(t||!e||!e.__esModule?Ee(n,"default",{value:e,enumerable:!0}):n,e)),Dt=e=>xt(Ee({},"__esModule",{value:!0}),e);var u=m(()=>{"use strict"});var de,je=m(()=>{u();de="b49dad6"});var ne,Ze=m(()=>{u();ne="ethan-davies/PersonalisedCord"});var Tt,Et=m(()=>{"use strict";u();je();Ze();Tt=`Vencord/${de}${ne?` (https://github.com/${ne})`:""}`});var Pe=m(()=>{"use strict";u()});function re(e,t={}){return new Promise((n,i)=>{Rt.default.get(e,t,r=>{let{statusCode:a,statusMessage:o,headers:c}=r;if(a>=400)return void i(`${a}: ${o} - ${e}`);if(a>=300)return void n(re(c.location,t));let s=[];r.on("error",i),r.on("data",l=>s.push(l)),r.once("end",()=>n(Buffer.concat(s)))})})}var Rt,Be=m(()=>{"use strict";u();Rt=K(require("https"))});function Ie(e){return async function(){try{return{ok:!0,value:await e(...arguments)}}catch(t){return{ok:!1,error:t instanceof Error?{...t}:t}}}}var Pt,kt=m(()=>{"use strict";u();Pt=["patcher.js","preload.js","renderer.js","renderer.css"]});var fr={};async function Gt(e){return re(cr+e,{headers:{Accept:"application/vnd.github+json","User-Agent":Tt}})}async function ur(){if(!await Mt())return[];let t=await Gt(`/compare/${de}...HEAD`);return JSON.parse(t.toString("utf-8")).commits.map(i=>({hash:i.sha.slice(0,7),author:i.author.login,message:i.commit.message}))}async function Mt(){let e=await Gt("/releases/latest"),t=JSON.parse(e.toString());return t.name.slice(t.name.lastIndexOf(" ")+1)===de?!1:(t.assets.forEach(({name:i,browser_download_url:r})=>{Pt.some(a=>i.startsWith(a))&&He.push([i,r])}),!0)}async function lr(){return await Promise.all(He.map(async([e,t])=>(0,_t.writeFile)((0,Nt.join)(__dirname,e),await re(t)))),He=[],!0}var Ae,_t,Nt,cr,He,Ut=m(()=>{"use strict";u();Et();Pe();Ae=require("electron"),_t=require("fs/promises"),Nt=require("path");je();Ze();Be();kt();cr=`https://api.github.com/repos/${ne}`,He=[];Ae.ipcMain.handle("VencordGetRepo",Ie(()=>`https://github.com/${ne}`));Ae.ipcMain.handle("VencordGetUpdates",Ie(ur));Ae.ipcMain.handle("VencordUpdate",Ie(Mt));Ae.ipcMain.handle("VencordBuild",Ie(lr))});var zt=m(()=>{"use strict";u();Promise.resolve().then(()=>Ut())});var Lt={};var Vt,bt=m(()=>{"use strict";u();Vt=require("electron");Ce();Vt.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(n,{frame:i})=>{i.once("dom-ready",()=>{if(i.url.startsWith("https://open.spotify.com/embed/")){let r=L().plugins?.FixSpotifyEmbeds;if(!r?.enabled)return;i.executeJavaScript(`
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = ${r.volume/100||.1};
                        return original.apply(this, arguments);
                    }
                `)}})})})});var Wt={};var Ft,jt=m(()=>{"use strict";u();Ft=require("electron");Ce();Ft.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(n,{frame:i})=>{i.once("dom-ready",()=>{if(i.url.startsWith("https://www.youtube.com/")){if(!L().plugins?.FixYoutubeEmbeds?.enabled)return;i.executeJavaScript(`
                new MutationObserver(() => {
                    let err = document.querySelector(".ytp-error-content-wrap-subreason span")?.textContent;
                    if (err && err.includes("blocked it from display")) window.location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})})});var Ke={};Re(Ke,{resolveRedirect:()=>hr});function Bt(e){return new Promise((t,n)=>{let i=(0,Zt.request)(new URL(e),{method:"HEAD"},r=>{t(r.headers.location?Bt(r.headers.location):e)});i.on("error",n),i.end()})}async function hr(e,t){return gr.test(t)?Bt(t):t}var Zt,gr,Ht=m(()=>{"use strict";u();Zt=require("https"),gr=/^https:\/\/(spotify\.link|s\.team)\/.+$/});var Ye={};Re(Ye,{readRecording:()=>pr});async function pr(e,t){t=(0,ye.normalize)(t);let n=(0,ye.basename)(t),i=(0,ye.normalize)(Kt.app.getPath("userData")+"/");if(console.log(n,i,t),n!=="recording.ogg"||!t.startsWith(i))return null;try{let r=await(0,Yt.readFile)(t);return new Uint8Array(r.buffer)}catch{return null}}var Kt,Yt,ye,Jt=m(()=>{"use strict";u();Kt=require("electron"),Yt=require("fs/promises"),ye=require("path")});var Je={};Re(Je,{sendToOverlay:()=>mr});function mr(e,t){t.icon=Buffer.from(t.icon).toString("base64");let n=JSON.stringify(t);qt??=(0,Xt.createSocket)("udp4"),qt.send(n,42069,"127.0.0.1")}var Xt,qt,Qt=m(()=>{"use strict";u();Xt=require("dgram")});var Y,qe=m(()=>{"use strict";u();Y=class{constructor(t=1/0){this.maxSize=t}queue=[];promise;next(){let t=this.queue.shift();t?this.promise=Promise.resolve().then(t).finally(()=>this.next()):this.promise=void 0}run(){this.promise||this.next()}push(t){this.size>=this.maxSize&&this.queue.shift(),this.queue.push(t),this.run()}unshift(t){this.size>=this.maxSize&&this.queue.pop(),this.queue.unshift(t),this.run()}get size(){return this.queue.length}}});var $t,J,ie,we,b,ae,Xe,en,ke,oe=m(()=>{"use strict";u();$t=require("electron"),J=require("path"),ie=process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,J.join)(process.env.DISCORD_USER_DATA_DIR,"..","VencordData"):(0,J.join)($t.app.getPath("userData"),"..","Vencord")),we=(0,J.join)(ie,"settings"),b=(0,J.join)(ie,"themes"),ae=(0,J.join)(we,"quickCss.css"),Xe=(0,J.join)(we,"settings.json"),en=["https:","http:","steam:","spotify:","com.epicgames.launcher:"],ke=process.argv.includes("--vanilla")});async function vr(e){try{return await(0,Oe.access)(e),!0}catch{return!1}}async function se(e){await vr(e)||await(0,Oe.mkdir)(e)}function Qe(e){return tn.default.parse(e).name}var Oe,tn,$e=m(()=>{"use strict";u();Oe=require("fs/promises"),tn=K(require("path"))});async function _e(){try{let e=await et.default.readFile(await rn(),"utf8");return JSON.parse(e)}catch{let t={logsDir:await F(),imageCacheDir:await Se()};try{await tt(t)}catch{}return t}}async function tt(e){!e||await et.default.writeFile(await rn(),JSON.stringify(e,null,4),"utf8")}async function rn(){let e=await F();return await se(e),nn.default.join(e,"mlSettings.json")}var et,nn,an=m(()=>{"use strict";u();et=K(require("fs/promises")),nn=K(require("path"));nt();$e()});var at={};Re(at,{chooseDir:()=>Dr,deleteFileNative:()=>yr,getDefaultNativeDataDir:()=>F,getDefaultNativeImageDir:()=>Se,getImageNative:()=>Ar,getLogsFromFs:()=>Sr,getNativeSavedImages:()=>Ir,getSettings:()=>_e,init:()=>un,initDirs:()=>cn,messageLoggerEnhancedUniqueIdThingyIdkMan:()=>dr,showItemInFolder:()=>Tr,writeImageNative:()=>Cr,writeLogs:()=>xr});function dr(){}async function cn(){let{logsDir:e,imageCacheDir:t}=await _e();rt=e||await F(),it=t||await Se()}async function un(e){let t=await on();await se(t);let n=await(0,P.readdir)(t);for(let i of n){let r=Qe(i);ce.set(r,q.default.join(t,i))}}async function Ar(e,t){let n=ce.get(t);return n?await(0,P.readFile)(n):null}async function Cr(e,t,n){if(!t||!n)return;let i=await on(),r=Qe(t);if(ce.get(r))return;let o=q.default.join(i,t);await se(i),await(0,P.writeFile)(o,n),ce.set(r,o)}async function yr(e,t){let n=ce.get(t);!n||await(0,P.unlink)(n)}async function Sr(e){let t=await sn();await se(t);try{return JSON.parse(await(0,P.readFile)(q.default.join(t,ln),"utf-8"))}catch{}return null}async function xr(e,t){let n=await sn();wr.push(()=>(0,P.writeFile)(q.default.join(n,ln),t))}async function Se(){return q.default.join(await F(),"savedImages")}async function F(){return q.default.join(ie,"MessageLoggerData")}async function Dr(e,t){let n=await _e(),i=n[t]||await F(),a=(await Ne.dialog.showOpenDialog({properties:["openDirectory"],defaultPath:i})).filePaths[0];if(!a)throw Error("Invalid Directory");switch(n[t]=a,await tt(n),t){case"logsDir":rt=a;break;case"imageCacheDir":it=a;break}return t==="imageCacheDir"&&await un(e),a}async function Tr(e,t){Ne.shell.showItemInFolder(t)}var P,q,Ne,ce,Ir,rt,it,on,sn,ln,wr,nt=m(()=>{"use strict";u();P=require("node:fs/promises"),q=K(require("node:path"));qe();Ne=require("electron");oe();an();$e();ce=new Map,Ir=()=>ce,on=async()=>it??await Se(),sn=async()=>rt??await F();cn();ln="message-logger-logs.json",wr=new Y});var fn,gn=m(()=>{u();bt();jt();Ht();Jt();Qt();nt();fn={FixSpotifyEmbeds:Lt,FixYoutubeEmbeds:Wt,OpenInApp:Ke,VoiceMessages:Ye,XsOverlay:Je,MessageLoggerEnhanced:at}});var ot,hn,pn=m(()=>{"use strict";u();Pe();ot=require("electron");gn();hn={};for(let[e,t]of Object.entries(fn)){let n=Object.entries(t);if(!n.length)continue;let i=hn[e]={};for(let[r,a]of n){let o=`VencordPluginNative_${e}_${r}`;ot.ipcMain.handle(o,a),i[r]=o}}ot.ipcMain.on("VencordGetPluginIpcMethodMap",e=>{e.returnValue=hn})});function st(e,t=300){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}var mn=m(()=>{"use strict";u()});var vn,dn=m(()=>{u();vn="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KICAgIDxoZWFkPgogICAgICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04IiAvPgogICAgICAgIDx0aXRsZT5WZW5jb3JkIFF1aWNrQ1NTIEVkaXRvcjwvdGl0bGU+CiAgICAgICAgPGxpbmsKICAgICAgICAgICAgcmVsPSJzdHlsZXNoZWV0IgogICAgICAgICAgICBocmVmPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9tb25hY28tZWRpdG9yLzAuNDAuMC9taW4vdnMvZWRpdG9yL2VkaXRvci5tYWluLm1pbi5jc3MiCiAgICAgICAgICAgIGludGVncml0eT0ic2hhNTEyLU1Pb1EwMmg4MGhrbGNjZkxyWEZZa0N6RytXVmpPUmZsT3A5WnA4ZGx0aWFSUCszNUxZbk80TEtPa2xSNjRvTUdmR2dKRExPOFdKcGtNMW81Z1pYWVpRPT0iCiAgICAgICAgICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICAgICAgICAgIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciIKICAgICAgICAvPgogICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgaHRtbCwKICAgICAgICAgICAgYm9keSwKICAgICAgICAgICAgI2NvbnRhaW5lciB7CiAgICAgICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgfQogICAgICAgIDwvc3R5bGU+CiAgICA8L2hlYWQ+CgogICAgPGJvZHk+CiAgICAgICAgPGRpdiBpZD0iY29udGFpbmVyIj48L2Rpdj4KICAgICAgICA8c2NyaXB0CiAgICAgICAgICAgIHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbW9uYWNvLWVkaXRvci8wLjQwLjAvbWluL3ZzL2xvYWRlci5taW4uanMiCiAgICAgICAgICAgIGludGVncml0eT0ic2hhNTEyLVF6TXBYZUNQY2lBSFA0d2JZbFYyUFlnclFjYUVrRFFVanprUFU0eG5qeVZTRDlUMzYvdWRhbXh0TkJxYjRxSzQvYk1RTVBaOGF5ckJlOWhyR2RCRmpRPT0iCiAgICAgICAgICAgIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiCiAgICAgICAgICAgIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciIKICAgICAgICA+PC9zY3JpcHQ+CgogICAgICAgIDxzY3JpcHQ+CiAgICAgICAgICAgIHJlcXVpcmUuY29uZmlnKHsKICAgICAgICAgICAgICAgIHBhdGhzOiB7CiAgICAgICAgICAgICAgICAgICAgdnM6ICJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9tb25hY28tZWRpdG9yLzAuNDAuMC9taW4vdnMiLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXF1aXJlKFsidnMvZWRpdG9yL2VkaXRvci5tYWluIl0sICgpID0+IHsKICAgICAgICAgICAgICAgIGdldEN1cnJlbnRDc3MoKS50aGVuKChjc3MpID0+IHsKICAgICAgICAgICAgICAgICAgICB2YXIgZWRpdG9yID0gbW9uYWNvLmVkaXRvci5jcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250YWluZXIiKSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlOiAiY3NzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1lOiBnZXRUaGVtZSgpLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBlZGl0b3Iub25EaWRDaGFuZ2VNb2RlbENvbnRlbnQoKCkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgc2V0Q3NzKGVkaXRvci5nZXRWYWx1ZSgpKQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFrZSBtb25hY28gcmUtbGF5b3V0CiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXRvci5sYXlvdXQoKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICA8L3NjcmlwdD4KICAgIDwvYm9keT4KPC9odG1sPgo="});function ct(e,t={}){return{fileName:e,name:t.name??e.replace(/\.css$/i,""),author:t.author??"Unknown Author",description:t.description??"A Discord Theme.",version:t.version,license:t.license,source:t.source,website:t.website,invite:t.invite}}function In(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e}function An(e,t){if(!e)return ct(t);let n=e.split("/**",2)?.[1]?.split("*/",1)?.[0];if(!n)return ct(t);let i={},r="",a="";for(let o of n.split(Er))if(o.length!==0)if(o.charAt(0)==="@"&&o.charAt(1)!==" "){i[r]=a.trim();let c=o.indexOf(" ");r=o.substring(1,c),a=o.substring(c+1)}else a+=" "+o.replace("\\n",`
`).replace(Rr,"@");return i[r]=a.trim(),delete i[""],ct(t,i)}var Er,Rr,Cn=m(()=>{"use strict";u();Er=/[^\S\r\n]*?\r?(?:\r\n|\n)[^\S\r\n]*?\*[^\S\r\n]?/,Rr=/^\\@/});function wn(e){e.webContents.setWindowOpenHandler(({url:t})=>{switch(t){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:n}=new URL(t)}catch{return{action:"deny"}}switch(n){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":yn.shell.openExternal(t)}return{action:"deny"}})}var yn,Sn=m(()=>{"use strict";u();yn=require("electron")});function ut(e,t){let n=(0,ue.normalize)(e),i=(0,ue.join)(e,t),r=(0,ue.normalize)(i);return r.startsWith(n)?r:null}function xn(){return(0,k.readFile)(ae,"utf-8").catch(()=>"")}async function Pr(){let e=await(0,k.readdir)(b).catch(()=>[]),t=[];for(let n of e){if(!n.endsWith(".css"))continue;let i=await Dn(n).then(In).catch(()=>null);i!=null&&t.push(An(i,n))}return t}function Dn(e){e=e.replace(/\?v=\d+$/,"");let t=ut(b,e);return t?(0,k.readFile)(t,"utf-8"):Promise.reject(`Unsafe path ${e}`)}function Tn(){try{return(0,W.readFileSync)(Xe,"utf-8")}catch{return"{}"}}function L(){try{return JSON.parse(Tn())}catch{return{}}}function En(e){(0,k.open)(ae,"a+").then(t=>{t.close(),(0,W.watch)(ae,{persistent:!1},st(async()=>{e.webContents.postMessage("VencordQuickCssUpdate",await xn())},50))}),(0,W.watch)(b,{persistent:!1},st(()=>{e.webContents.postMessage("VencordThemeUpdate",void 0)}))}var v,W,k,ue,kr,Or,Ce=m(()=>{"use strict";u();zt();pn();mn();Pe();qe();v=require("electron"),W=require("fs"),k=require("fs/promises"),ue=require("path");dn();Cn();oe();Sn();(0,W.mkdirSync)(we,{recursive:!0});(0,W.mkdirSync)(b,{recursive:!0});v.ipcMain.handle("VencordOpenQuickCss",()=>v.shell.openPath(ae));v.ipcMain.handle("VencordOpenExternal",(e,t)=>{try{var{protocol:n}=new URL(t)}catch{throw"Malformed URL"}if(!en.includes(n))throw"Disallowed protocol.";v.shell.openExternal(t)});kr=new Y,Or=new Y;v.ipcMain.handle("VencordGetQuickCss",()=>xn());v.ipcMain.handle("VencordSetQuickCss",(e,t)=>kr.push(()=>(0,k.writeFile)(ae,t)));v.ipcMain.handle("VencordGetThemesDir",()=>b);v.ipcMain.handle("VencordGetThemesList",()=>Pr());v.ipcMain.handle("VencordGetThemeData",(e,t)=>Dn(t));v.ipcMain.handle("VencordGetThemeSystemValues",()=>({"os-accent-color":`#${v.systemPreferences.getAccentColor?.()||""}`}));v.ipcMain.handle("VencordGetSettingsDir",()=>we);v.ipcMain.on("VencordGetSettings",e=>e.returnValue=Tn());v.ipcMain.handle("VencordSetSettings",(e,t)=>{Or.push(()=>(0,k.writeFile)(Xe,t))});v.ipcMain.handle("VencordOpenMonacoEditor",async()=>{let e="Vencord QuickCSS Editor",t=v.BrowserWindow.getAllWindows().find(i=>i.title===e);if(t&&!t.isDestroyed()){t.focus();return}let n=new v.BrowserWindow({title:e,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,ue.join)(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});wn(n),await n.loadURL(`data:text/html;base64,${vn}`)})});function Jn(e,t,n){let i=t;if(t in e)return void n(e[i]);Object.defineProperty(e,t,{set(r){delete e[i],e[i]=r,n(r)},configurable:!0,enumerable:!1})}var qn=m(()=>{"use strict";u()});var $r={};function Xr(e,t){let n=e.slice(4).split(".").map(Number),i=t.slice(4).split(".").map(Number);for(let r=0;r<i.length;r++){if(n[r]>i[r])return!0;if(n[r]<i[r])return!1}return!1}function Qr(){if(!process.env.DISABLE_UPDATER_AUTO_PATCHING)try{let e=(0,D.dirname)(process.execPath),t=(0,D.basename)(e),n=(0,D.join)(e,".."),i=(0,w.readdirSync)(n).reduce((c,s)=>s.startsWith("app-")&&Xr(s,c)?s:c,t);if(i===t)return;let r=(0,D.join)(n,i,"resources"),a=(0,D.join)(r,"app.asar"),o=(0,D.join)(r,"_app.asar");if(!(0,w.existsSync)(a)||(0,w.statSync)(a).isDirectory())return;console.info("[Vencord] Detected Host Update. Repatching..."),(0,w.renameSync)(a,o),(0,w.mkdirSync)(a),(0,w.writeFileSync)((0,D.join)(a,"package.json"),JSON.stringify({name:"discord",main:"index.js"})),(0,w.writeFileSync)((0,D.join)(a,"index.js"),`require(${JSON.stringify((0,D.join)(__dirname,"patcher.js"))});`)}catch(e){console.error("[Vencord] Failed to repatch latest host update",e)}}var Xn,w,D,Qn=m(()=>{"use strict";u();Xn=require("electron"),w=require("original-fs"),D=require("path");Xn.app.on("before-quit",Qr)});var ri={};var R,Z,ei,ti,dt,ni,$n=m(()=>{"use strict";u();qn();R=K(require("electron")),Z=require("path");Ce();oe();console.log("[Vencord] Starting up...");ei=require.main.filename,ti=require.main.path.endsWith("app.asar")?"_app.asar":"app.asar",dt=(0,Z.join)((0,Z.dirname)(ei),"..",ti),ni=require((0,Z.join)(dt,"package.json"));require.main.filename=(0,Z.join)(dt,ni.main);R.app.setAppPath(dt);if(ke)console.log("[Vencord] Running in vanilla mode. Not loading Vencord");else{let e=L();if(process.platform==="win32"&&(Qn(),e.winCtrlQ)){let i=R.Menu.buildFromTemplate;R.Menu.buildFromTemplate=function(r){if(r[0]?.label==="&File"){let{submenu:a}=r[0];Array.isArray(a)&&a.push({label:"Quit (Hidden)",visible:!1,acceleratorWorksWhenHidden:!0,accelerator:"Control+Q",click:()=>R.app.quit()})}return i.call(this,r)}}class t extends R.default.BrowserWindow{constructor(r){if(r?.webPreferences?.preload&&r.title){let a=r.webPreferences.preload;r.webPreferences.preload=(0,Z.join)(__dirname,"preload.js"),r.webPreferences.sandbox=!1,e.frameless?r.frame=!1:process.platform==="win32"&&e.winNativeTitleBar&&delete r.frame,e.transparent&&(r.transparent=!0,r.backgroundColor="#00000000"),(process.platform==="darwin"||e.macosVibrancyStyle||e.macosTranslucency)&&(r.backgroundColor="#00000000",e.macosTranslucency?r.vibrancy="sidebar":e.macosVibrancyStyle&&(r.vibrancy=e.macosVibrancyStyle)),process.env.DISCORD_PRELOAD=a,super(r),En(this)}else super(r)}}Object.assign(t,R.default.BrowserWindow),Object.defineProperty(t,"name",{value:"BrowserWindow",configurable:!0});let n=require.resolve("electron");delete require.cache[n].exports,require.cache[n].exports={...R.default,BrowserWindow:t},Jn(global,"appSettings",i=>{i.set("DANGEROUS_ENABLE_DEVTOOLS_ONLY_ENABLE_IF_YOU_KNOW_WHAT_YOURE_DOING",!0),e.disableMinSize?(i.set("MIN_WIDTH",0),i.set("MIN_HEIGHT",0)):(i.set("MIN_WIDTH",940),i.set("MIN_HEIGHT",500))}),process.env.DATA_DIR=(0,Z.join)(R.app.getPath("userData"),"..","Vencord")}console.log("[Vencord] Loading original Discord app.asar");require(require.main.filename)});u();var X=require("electron"),er=require("path");Ce();oe();u();var Hn=require("electron");u();var kn=require("module"),_r=(0,kn.createRequire)("/"),Me,Nr=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{Me=_r("worker_threads").Worker}catch{}var Gr=Me?function(e,t,n,i,r){var a=!1,o=new Me(e+Nr,{eval:!0}).on("error",function(c){return r(c,null)}).on("message",function(c){return r(null,c)}).on("exit",function(c){c&&!a&&r(new Error("exited with code "+c),null)});return o.postMessage(n,i),o.terminate=function(){return a=!0,Me.prototype.terminate.call(o)},o}:function(e,t,n,i,r){setImmediate(function(){return r(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var a=function(){};return{terminate:a,postMessage:a}},C=Uint8Array,j=Uint16Array,gt=Uint32Array,ht=new C([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pt=new C([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),On=new C([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_n=function(e,t){for(var n=new j(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];for(var r=new gt(n[30]),i=1;i<30;++i)for(var a=n[i];a<n[i+1];++a)r[a]=a-n[i]<<5|i;return[n,r]},Nn=_n(ht,2),mt=Nn[0],Mr=Nn[1];mt[28]=258,Mr[258]=28;var Gn=_n(pt,0),Mn=Gn[0],Sa=Gn[1],Ve=new j(32768);for(h=0;h<32768;++h)G=(h&43690)>>>1|(h&21845)<<1,G=(G&52428)>>>2|(G&13107)<<2,G=(G&61680)>>>4|(G&3855)<<4,Ve[h]=((G&65280)>>>8|(G&255)<<8)>>>1;var G,h,le=function(e,t,n){for(var i=e.length,r=0,a=new j(t);r<i;++r)e[r]&&++a[e[r]-1];var o=new j(t);for(r=0;r<t;++r)o[r]=o[r-1]+a[r-1]<<1;var c;if(n){c=new j(1<<t);var s=15-t;for(r=0;r<i;++r)if(e[r])for(var l=r<<4|e[r],p=t-e[r],d=o[e[r]-1]++<<p,T=d|(1<<p)-1;d<=T;++d)c[Ve[d]>>>s]=l}else for(c=new j(i),r=0;r<i;++r)e[r]&&(c[r]=Ve[o[e[r]-1]++]>>>15-e[r]);return c},xe=new C(288);for(h=0;h<144;++h)xe[h]=8;var h;for(h=144;h<256;++h)xe[h]=9;var h;for(h=256;h<280;++h)xe[h]=7;var h;for(h=280;h<288;++h)xe[h]=8;var h,Un=new C(32);for(h=0;h<32;++h)Un[h]=5;var h;var zn=le(xe,9,1);var Vn=le(Un,5,1),Ue=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},x=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(t&7)&n},ze=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(t&7)},Ln=function(e){return(e+7)/8|0},Le=function(e,t,n){(t==null||t<0)&&(t=0),(n==null||n>e.length)&&(n=e.length);var i=new(e.BYTES_PER_ELEMENT==2?j:e.BYTES_PER_ELEMENT==4?gt:C)(n-t);return i.set(e.subarray(t,n)),i};var bn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],y=function(e,t,n){var i=new Error(t||bn[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,y),!n)throw i;return i},Fn=function(e,t,n){var i=e.length;if(!i||n&&n.f&&!n.l)return t||new C(0);var r=!t||n,a=!n||n.i;n||(n={}),t||(t=new C(i*3));var o=function(yt){var wt=t.length;if(yt>wt){var St=new C(Math.max(wt*2,yt));St.set(t),t=St}},c=n.f||0,s=n.p||0,l=n.b||0,p=n.l,d=n.d,T=n.m,M=n.n,ge=i*8;do{if(!p){c=x(e,s,1);var B=x(e,s+1,3);if(s+=3,B)if(B==1)p=zn,d=Vn,T=9,M=5;else if(B==2){var z=x(e,s,31)+257,Q=x(e,s+10,15)+4,he=z+x(e,s+5,31)+1;s+=14;for(var H=new C(he),pe=new C(19),A=0;A<Q;++A)pe[On[A]]=x(e,s+A*3,7);s+=Q*3;for(var N=Ue(pe),De=(1<<N)-1,$=le(pe,N,1),A=0;A<he;){var me=$[x(e,s,De)];s+=me&15;var I=me>>>4;if(I<16)H[A++]=I;else{var ee=0,Te=0;for(I==16?(Te=3+x(e,s,3),s+=2,ee=H[A-1]):I==17?(Te=3+x(e,s,7),s+=3):I==18&&(Te=11+x(e,s,127),s+=7);Te--;)H[A++]=ee}}var It=H.subarray(0,z),V=H.subarray(z);T=Ue(It),M=Ue(V),p=le(It,T,1),d=le(V,M,1)}else y(1);else{var I=Ln(s)+4,S=e[I-4]|e[I-3]<<8,U=I+S;if(U>i){a&&y(0);break}r&&o(l+S),t.set(e.subarray(I,U),l),n.b=l+=S,n.p=s=U*8,n.f=c;continue}if(s>ge){a&&y(0);break}}r&&o(l+131072);for(var tr=(1<<T)-1,nr=(1<<M)-1,be=s;;be=s){var ee=p[ze(e,s)&tr],te=ee>>>4;if(s+=ee&15,s>ge){a&&y(0);break}if(ee||y(2),te<256)t[l++]=te;else if(te==256){be=s,p=null;break}else{var At=te-254;if(te>264){var A=te-257,ve=ht[A];At=x(e,s,(1<<ve)-1)+mt[A],s+=ve}var Fe=d[ze(e,s)&nr],We=Fe>>>4;Fe||y(3),s+=Fe&15;var V=Mn[We];if(We>3){var ve=pt[We];V+=ze(e,s)&(1<<ve)-1,s+=ve}if(s>ge){a&&y(0);break}r&&o(l+131072);for(var Ct=l+At;l<Ct;l+=4)t[l]=t[l-V],t[l+1]=t[l+1-V],t[l+2]=t[l+2-V],t[l+3]=t[l+3-V];l=Ct}}n.l=p,n.p=be,n.b=l,n.f=c,p&&(c=1,n.m=T,n.d=d,n.n=M)}while(!c);return l==t.length?t:Le(t,0,l)};var Ur=new C(0);var zr=function(e,t){var n={};for(var i in e)n[i]=e[i];for(var i in t)n[i]=t[i];return n},Rn=function(e,t,n){for(var i=e(),r=e.toString(),a=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<i.length;++o){var c=i[o],s=a[o];if(typeof c=="function"){t+=";"+s+"=";var l=c.toString();if(c.prototype)if(l.indexOf("[native code]")!=-1){var p=l.indexOf(" ",8)+1;t+=l.slice(p,l.indexOf("(",p))}else{t+=l;for(var d in c.prototype)t+=";"+s+".prototype."+d+"="+c.prototype[d].toString()}else t+=l}else n[s]=c}return[t,n]},Ge=[],Vr=function(e){var t=[];for(var n in e)e[n].buffer&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t},Lr=function(e,t,n,i){var r;if(!Ge[n]){for(var a="",o={},c=e.length-1,s=0;s<c;++s)r=Rn(e[s],a,o),a=r[0],o=r[1];Ge[n]=Rn(e[c],a,o)}var l=zr({},Ge[n][1]);return Gr(Ge[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,l,Vr(l),i)},br=function(){return[C,j,gt,ht,pt,On,mt,Mn,zn,Vn,Ve,bn,le,Ue,x,ze,Ln,Le,y,Fn,vt,Wn,jn]};var Wn=function(e){return postMessage(e,[e.buffer])},jn=function(e){return e&&e.size&&new C(e.size)},Fr=function(e,t,n,i,r,a){var o=Lr(n,i,r,function(c,s){o.terminate(),a(c,s)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}};var O=function(e,t){return e[t]|e[t+1]<<8},E=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},lt=function(e,t){return E(e,t)+E(e,t+4)*4294967296};function Wr(e,t,n){return n||(n=t,t={}),typeof n!="function"&&y(7),Fr(e,t,[br],function(i){return Wn(vt(i.data[0],jn(i.data[1])))},1,n)}function vt(e,t){return Fn(e,t)}var ft=typeof TextDecoder<"u"&&new TextDecoder,jr=0;try{ft.decode(Ur,{stream:!0}),jr=1}catch{}var Zr=function(e){for(var t="",n=0;;){var i=e[n++],r=(i>127)+(i>223)+(i>239);if(n+r>e.length)return[t,Le(e,n-1)];r?r==3?(i=((i&15)<<18|(e[n++]&63)<<12|(e[n++]&63)<<6|e[n++]&63)-65536,t+=String.fromCharCode(55296|i>>10,56320|i&1023)):r&1?t+=String.fromCharCode((i&31)<<6|e[n++]&63):t+=String.fromCharCode((i&15)<<12|(e[n++]&63)<<6|e[n++]&63):t+=String.fromCharCode(i)}};function Br(e,t){if(t){for(var n="",i=0;i<e.length;i+=16384)n+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return n}else{if(ft)return ft.decode(e);var r=Zr(e),a=r[0],o=r[1];return o.length&&y(8),a}}var Hr=function(e,t){return t+30+O(e,t+26)+O(e,t+28)},Kr=function(e,t,n){var i=O(e,t+28),r=Br(e.subarray(t+46,t+46+i),!(O(e,t+8)&2048)),a=t+46+i,o=E(e,t+20),c=n&&o==4294967295?Yr(e,a):[o,E(e,t+24),E(e,t+42)],s=c[0],l=c[1],p=c[2];return[O(e,t+10),s,l,r,a+O(e,t+30)+O(e,t+32),p]},Yr=function(e,t){for(;O(e,t)!=1;t+=4+O(e,t+2));return[lt(e,t+12),lt(e,t+4),lt(e,t+20)]};var Pn=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function Zn(e,t,n){n||(n=t,t={}),typeof n!="function"&&y(7);var i=[],r=function(){for(var I=0;I<i.length;++I)i[I]()},a={},o=function(I,S){Pn(function(){n(I,S)})};Pn(function(){o=n});for(var c=e.length-22;E(e,c)!=101010256;--c)if(!c||e.length-c>65558)return o(y(13,0,1),null),r;var s=O(e,c+8);if(s){var l=s,p=E(e,c+16),d=p==4294967295||l==65535;if(d){var T=E(e,c-12);d=E(e,T)==101075792,d&&(l=s=E(e,T+32),p=E(e,T+48))}for(var M=t&&t.filter,ge=function(I){var S=Kr(e,p,d),U=S[0],z=S[1],Q=S[2],he=S[3],H=S[4],pe=S[5],A=Hr(e,pe);p=H;var N=function($,me){$?(r(),o($,null)):(me&&(a[he]=me),--s||o(null,a))};if(!M||M({name:he,size:z,originalSize:Q,compression:U}))if(!U)N(null,Le(e,A,A+z));else if(U==8){var De=e.subarray(A,A+z);if(z<32e4)try{N(null,vt(De,new C(Q)))}catch($){N($,null)}else i.push(Wr(De,{size:Q},N))}else N(y(14,"unknown compression type "+U,1),null);else N(null,null)},B=0;B<l;++B)ge(B)}else o(null,{});return r}var Kn=require("fs"),_=require("fs/promises"),fe=require("path");oe();u();function Bn(e){function t(o,c,s,l){let p=0;return p+=o<<0,p+=c<<8,p+=s<<16,p+=l<<24>>>0,p}if(e[0]===80&&e[1]===75&&e[2]===3&&e[3]===4)return e;if(e[0]!==67||e[1]!==114||e[2]!==50||e[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let n=e[4]===3,i=e[4]===2;if(!i&&!n||e[5]||e[6]||e[7])throw new Error("Unexpected crx format version number.");if(i){let o=t(e[8],e[9],e[10],e[11]),c=t(e[12],e[13],e[14],e[15]),s=16+o+c;return e.subarray(s,e.length)}let a=12+t(e[8],e[9],e[10],e[11]);return e.subarray(a,e.length)}Be();var Jr=(0,fe.join)(ie,"ExtensionCache");async function qr(e,t){return await(0,_.mkdir)(t,{recursive:!0}),new Promise((n,i)=>{Zn(e,(r,a)=>{if(r)return void i(r);Promise.all(Object.keys(a).map(async o=>{if(o.startsWith("_metadata/"))return;if(o.endsWith("/"))return void(0,_.mkdir)((0,fe.join)(t,o),{recursive:!0});let c=o.split("/"),s=c.pop(),l=c.join("/"),p=(0,fe.join)(t,l);l&&await(0,_.mkdir)(p,{recursive:!0}),await(0,_.writeFile)((0,fe.join)(p,s),a[o])})).then(()=>n()).catch(o=>{(0,_.rm)(t,{recursive:!0,force:!0}),i(o)})})})}async function Yn(e){let t=(0,fe.join)(Jr,`${e}`);try{await(0,_.access)(t,Kn.constants.F_OK)}catch{let i=e==="fmkadmapgofadopljbjfkapdkoienihi"?"https://raw.githubusercontent.com/Vendicated/random-files/f6f550e4c58ac5f2012095a130406c2ab25b984d/fmkadmapgofadopljbjfkapdkoienihi.zip":`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${e}%26uc&prodversion=32`,r=await re(i,{headers:{"User-Agent":"Vencord (https://github.com/Vendicated/Vencord)"}});await qr(Bn(r),t).catch(console.error)}Hn.session.defaultSession.loadExtension(t)}ke||X.app.whenReady().then(()=>{X.protocol.registerFileProtocol("vencord",({url:r},a)=>{let o=r.slice(10);if(o.endsWith("/")&&(o=o.slice(0,-1)),o.startsWith("/themes/")){let c=o.slice(8),s=ut(b,c);if(!s){a({statusCode:403});return}a(s.replace(/\?v=\d+$/,""));return}switch(o){case"renderer.js.map":case"vencordDesktopRenderer.js.map":case"preload.js.map":case"vencordDesktopPreload.js.map":case"patcher.js.map":case"vencordDesktopMain.js.map":a((0,er.join)(__dirname,o));break;default:a({statusCode:403})}});try{L().enableReactDevtools&&Yn("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Vencord] Installed React Developer Tools")).catch(r=>console.error("[Vencord] Failed to install React Developer Tools",r))}catch{}let e=(r,a)=>Object.keys(r).find(o=>o.toLowerCase()===a),t=r=>{let a={};return r.split(";").forEach(o=>{let[c,...s]=o.trim().split(/\s+/g);c&&!Object.prototype.hasOwnProperty.call(a,c)&&(a[c]=s)}),a},n=r=>Object.entries(r).filter(([,a])=>a?.length).map(a=>a.flat().join(" ")).join("; "),i=r=>{let a=e(r,"content-security-policy");if(a){let o=t(r[a][0]);for(let c of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o[c]??=[],o[c].push("*","blob:","data:","vencord:","'unsafe-inline'");o["script-src"]??=[],o["script-src"].push("'unsafe-eval'","https://unpkg.com","https://cdnjs.cloudflare.com"),r[a]=[n(o)]}};X.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:r,resourceType:a},o)=>{if(r&&(a==="mainFrame"&&i(r),a==="stylesheet")){let c=e(r,"content-type");c&&(r[c]=["text/css"])}o({cancel:!1,responseHeaders:r})}),X.session.defaultSession.webRequest.onHeadersReceived=()=>{}});$n();
//# sourceURL=VencordPatcher
//# sourceMappingURL=vencord://patcher.js.map
/*! For license information please see patcher.js.LEGAL.txt */
